<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ú–∞—Ç—Ä–∏—Ü–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –∫—É–±–∏–∫–∞–º–∏</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f2f5;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
h2 { margin-bottom: 20px; }
button, select {
  padding: 8px 15px;
  font-size: 14px;
  margin: 5px;
  cursor: pointer;
}
table { border-collapse: collapse; margin-top: 20px; background: #fff; }
td, th { border: 1px solid #333; padding: 10px; width: 160px; text-align: center; }
td { cursor: pointer; position: relative; }

/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤ */
td[data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 100%; left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 5px 10px;
  border-radius: 5px;
  white-space: nowrap;
  margin-top: 5px;
  z-index: 5;
  font-size: 12px;
}

#diceResult { margin-top: 20px; font-size: 18px; font-weight: bold; }

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
  display: none; 
  position: fixed; 
  z-index: 10; 
  left: 0; top: 0; width: 100%; height: 100%; 
  overflow: auto; background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background-color: #fff; margin: 15% auto; padding: 20px; border-radius: 10px; width: 350px;
  display: flex; flex-direction: column; gap: 10px;
}
.modal-content input { padding: 8px; font-size: 14px; }
.modal-content label { font-weight: bold; }
.modal-buttons { display:flex; justify-content: flex-end; gap:10px; }

/* Drop zone */
#drop-zone {
  margin-top: 10px;
  padding: 20px;
  border: 2px dashed #888;
  text-align: center;
  width: 300px;
  transition: background 0.2s;
}
#drop-zone.hover { background: #f0f0f0; }
</style>
</head>
<body>
<h2 id="mainTitle">–ú–∞—Ç—Ä–∏—Ü–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –∫—É–±–∏–∫–∞–º–∏</h2>

<div>
  <button id="rollBtn" onclick="rollDice()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏ üé≤üé≤</button>
  <select id="languageSelect" onchange="changeLanguage()">
    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
    <option value="en">English</option>
    <option value="th">‡πÑ‡∏ó‡∏¢</option>
  </select>
  <button onclick="exportJSON()">–°–∫–∞—á–∞—Ç—å JSON</button>
  <input type="file" id="importFile" style="display:none" onchange="importJSON(event)">
  <button onclick="document.getElementById('importFile').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
</div>

<div id="drop-zone">–ò–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞</div>

<div id="diceResult"></div>

<table id="actionTable">
  <thead>
    <tr>
      <th id="cubeHeader">–ö—É–±–∏–∫ 1 \ –ö—É–±–∏–∫ 2</th>
      <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="modal" class="modal">
  <div class="modal-content">
    <label id="labelRu">–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:</label>
    <input type="text" id="inputRu" placeholder="–†—É—Å—Å–∫–∏–π">
    <label id="labelEn">–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:</label>
    <input type="text" id="inputEn" placeholder="English">
    <label id="labelTh">–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ç–∞–π—Å–∫–æ–º:</label>
    <input type="text" id="inputTh" placeholder="‡πÑ‡∏ó‡∏¢">
    <div class="modal-buttons">
      <button id="saveBtn" onclick="saveAction()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="cancelBtn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
const tableBody = document.querySelector('#actionTable tbody');
let actions = JSON.parse(localStorage.getItem('actions')) || {};
let currentCell = null;
let currentLanguage = document.getElementById('languageSelect').value;

// –¢–µ–∫—Å—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
const interfaceText = {
  ru: {
    title: "–ú–∞—Ç—Ä–∏—Ü–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –∫—É–±–∏–∫–∞–º–∏",
    rollButton: "–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏ üé≤üé≤",
    diceResult: "–í—ã–ø–∞–ª–æ",
    cubeHeader: "–ö—É–±–∏–∫ 1 \\ –ö—É–±–∏–∫ 2",
    modal: { ru: "–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:", en: "–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:", th: "–î–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ç–∞–π—Å–∫–æ–º:" },
    save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
    cancel: "–û—Ç–º–µ–Ω–∞"
  },
  en: {
    title: "Dice Action Matrix",
    rollButton: "Roll Dice üé≤üé≤",
    diceResult: "Rolled",
    cubeHeader: "Die 1 \\ Die 2",
    modal: { ru: "Action in Russian:", en: "Action in English:", th: "Action in Thai:" },
    save: "Save",
    cancel: "Cancel"
  },
  th: {
    title: "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤",
    rollButton: "‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ üé≤üé≤",
    diceResult: "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå",
    cubeHeader: "‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 1 \\ ‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ 2",
    modal: { ru: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢:", en: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©:", th: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢:" },
    save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }
};

const die = {
  1: '‚öÄ',
  2: '‚öÅ',
  3: '‚öÇ',
  4: '‚öÉ',
  5: '‚öÑ',
  6: '‚öÖ',
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
for (let i = 1; i <= 6; i++) {
  const tr = document.createElement('tr');
  const th = document.createElement('th');
  th.textContent = i;
  tr.appendChild(th);

  for (let j = 1; j <= 6; j++) {
    const td = document.createElement('td');
    td.dataset.row = i;
    td.dataset.col = j;
    td.addEventListener('click', () => openModal(td));
    tr.appendChild(td);
  }
  tableBody.appendChild(tr);
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞
function changeLanguage() {
  currentLanguage = document.getElementById('languageSelect').value;
  updateTableLanguage();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateTableLanguage() {
  tableBody.querySelectorAll('td').forEach(td => {
    const key = `${td.dataset.row}-${td.dataset.col}`;
    const act = actions[key] || {};
    td.textContent = act[currentLanguage] || '';
    td.dataset.tooltip = `RU: ${act.ru || ''} | EN: ${act.en || ''} | TH: ${act.th || ''}`;
  });
  updateInterfaceLanguage();
}

function updateInterfaceLanguage() {
  const lang = currentLanguage;
  document.getElementById('mainTitle').textContent = interfaceText[lang].title;
  document.getElementById('rollBtn').textContent = interfaceText[lang].rollButton;
  document.getElementById('cubeHeader').textContent = interfaceText[lang].cubeHeader;
  document.getElementById('diceResult').textContent = '';
  
  document.getElementById('labelRu').textContent = interfaceText[lang].modal.ru;
  document.getElementById('labelEn').textContent = interfaceText[lang].modal.en;
  document.getElementById('labelTh').textContent = interfaceText[lang].modal.th;
  document.getElementById('saveBtn').textContent = interfaceText[lang].save;
  document.getElementById('cancelBtn').textContent = interfaceText[lang].cancel;
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
const modal = document.getElementById('modal');
const inputRu = document.getElementById('inputRu');
const inputEn = document.getElementById('inputEn');
const inputTh = document.getElementById('inputTh');

function openModal(cell) {
  currentCell = cell;
  const key = `${cell.dataset.row}-${cell.dataset.col}`;
  const act = actions[key] || {};
  inputRu.value = act.ru || '';
  inputEn.value = act.en || '';
  inputTh.value = act.th || '';
  modal.style.display = 'block';
  inputRu.focus();
}

function closeModal() { modal.style.display = 'none'; }

function saveAction() {
  if (!currentCell) return;
  const key = `${currentCell.dataset.row}-${currentCell.dataset.col}`;
  actions[key] = { ru: inputRu.value, en: inputEn.value, th: inputTh.value };
  localStorage.setItem('actions', JSON.stringify(actions));
  updateTableLanguage();
  closeModal();
}

// –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–æ–≤
function rollDice() {
  const dice1 = Math.floor(Math.random() * 6) + 1;
  const dice2 = Math.floor(Math.random() * 6) + 1;
  const key = `${dice1}-${dice2}`;
  const act = actions[key] || {};
  const actionText = act[currentLanguage] || "–î–µ–π—Å—Ç–≤–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ";
  document.getElementById('diceResult').textContent = 
    `${interfaceText[currentLanguage].diceResult}: ${dice1} –∏ ${dice2}. ${actionText}`;
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
window.onclick = function(event) {
  if (event.target == modal) closeModal();
}

// –≠–∫—Å–ø–æ—Ä—Ç JSON
function exportJSON() {
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(actions, null, 2));
  const dlAnchor = document.createElement('a');
  dlAnchor.setAttribute("href", dataStr);
  dlAnchor.setAttribute("download", "actions.json");
  dlAnchor.click();
}

// –ò–º–ø–æ—Ä—Ç JSON —á–µ—Ä–µ–∑ input
function importJSON(event) {
  const file = event.target.files[0];
  if (!file) return;
  handleFile(file);
}

// Drag & Drop
const dropZone = document.getElementById('drop-zone');

dropZone.addEventListener('dragover', (event) => {
  event.preventDefault();
  dropZone.classList.add('hover');
});

dropZone.addEventListener('dragleave', () => {
  dropZone.classList.remove('hover');
});

dropZone.addEventListener('drop', (event) => {
  event.preventDefault();
  dropZone.classList.remove('hover');
  const file = event.dataTransfer.files[0];
  if (file) handleFile(file);
});

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const json = JSON.parse(e.target.result);
      actions = json;
      localStorage.setItem('actions', JSON.stringify(actions));
      updateTableLanguage();
      alert("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
    } catch(err) {
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JSON: " + err);
    }
  };
  reader.readAsText(file);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateTableLanguage();
</script>
</body>
</html>
